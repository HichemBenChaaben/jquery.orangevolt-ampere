<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<!--
	  Copyright (c) 2011 Lars Gersmann (lars.gersmann@gmail.com, http://orangevolt.blogspot.com)
	  Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
	  and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
	--> 
	<head>  
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=7,chrome=1; IE=9" />
		
		<title>Ampere Shopping cart/Checkout example</title>
		
		<style>
			html {
				height 		: 100%;
			}
			
			body {
				height 		: 100%;
				margin 		: 0;
				overflow 	: hidden;
			}
		</style>
		
		<script type="text/javascript" src="../../lib/jquery-1.5.1.js"></script>
		<script type="text/javascript" src="../../lib/jquery/plugins/jquery.defer.js"></script>
		<script type="text/javascript" src="../../src/jquery.ampere-defer.js"></script>
		
		<script id="introduction" type="text/x-jquery-tmpl">
			<div style="padding:10px"> 
				<p>
					This application shows a shopping cart checkout scenario implemented using Ampere.
					<p>
						{{transition( state.transitions.cart)}}
					</p>
				</p>
			</div>
		</script>
		<script id="cart" type="text/x-jquery-tmpl">
			<div style="padding:10px"> 
				<h2>Cart contents</h2>

				{{if state.items && state.items.length}}
				<table>
					<thead>
						<tr>
							<td><!-- radio --></td>
							<td><!-- item --></td>
							<td><!-- options --></td>
							<td align="right" style="color:gray">Price</td>
							<td align="right" style="color:gray">Amount</td>
							<td align="right" style="color:gray">Subtotal</td>
						</tr>
					<thead>
					<tbody>
					{{each state.items}}
					<tr>
						<td>
							{{radio({ name:'selected', value:$index, label:false})}}
						</td>	
						<td>
							<a href="${$value.url}" target="_blank">${$value.label}</a>
						</td>
						<td style="color:gray">
							{{each $value.options}}
								${ucwords( $index)}=${ucwords( $value.value || (typeof( $value)=='string' ? $value : '<Empty>'))}
							{{/each}}	
						</td>
						<td align="right" style="font-family:monospace">${$.global.format( $value.price, "c")}</td>
						<td align="right" style="font-family:monospace">${$.global.format( $value.amount, "n0")}</td>
						<td align="right" style="font-family:monospace">${$.global.format( $value.price * $value.amount, "c")}</td>
					</tr>
					{{/each}}
					<tr>
						<td colspan="2">
						 	{{group}}
								{{transition( state.transitions.cart_edit)}}
								{{transition( state.transitions.cart_remove)}}								
							{{/group}}
						</td>
						<td colspan="4">
						</td>
					</tr>
					</tbody>
					<tfoot>
					<tr>
						<td colspan="6">
							<hr style="margin-top:1px;margin-bottom:1px;border:0;color:#aaaaaa;height:1px;background-color:gray"/>
						</td>
					</tr>
					<tr>
						<td colspan="5" align="right" style="color:gray">Total</td>
						<td align="right" style="font-family:monospace">${$.global.format( 9999.99, "c")}</td>
					</tr>					
					</tfoot>					
				</table>
				{{else}}
					<p>Your cart is empty.</p>
				{{/if}}
			</div>
		</script>
		
		<script id="cart_remove" type="text/x-jquery-tmpl">
			<div style="padding:10px">
				{{with state.module.states.cart.items[ state.module.states.cart.selected]}} 
					<p>
						Really want to remove
						<p>
							<a href="${$value.url}" target="_blank">
								${$value.label}
							</a>
							<ul>	 
							{{each $value.options}}
								<li>${ucwords( $index)} : ${ucwords( $value.value || (typeof( $value)=='string' ? $value : '<Empty>'))}</li>
							{{/each}}
							</ul>		
						</p>
						from your cart ?
					</p>
					{{if $value.options}}	
					<p>
						<strong>Tip</strong> : Is the item correct but the options does not fit ?<br/> 
						Click {{transition( state.transitions.cart_edit)}} to adjust the item options to fit your needs.
					</p>
					{{/if}}
				{{/with}}
			</div>
		</script>
		
		<script id="cart_edit" type="text/x-jquery-tmpl">
			<div style="padding:10px">
				{{with state.module.states.cart.items[ state.module.states.cart.selected]}}  
				<p>
					Edit
					<p>
						<a href="${$value.url}" target="_blank">
							${$value.label}
						</a>
					</p>	
					cart options :
				</p>
				<p>
					<dl>	 
					{{each( name, options) $value.options}}
						{{field({label : ucwords( name), required : !options.optional})}}
							{{if options.values}}
								{{group}}
									{{if options.optional}}
										{{radio({ name : name, value : false, icon : 'ui-icon-close', label : 'None', selected : true})}}
									{{/if}}
									{{each options.values}}
										{{radio({ name : name, value : $value, icon : false, selected : $value==options.value})}}
									{{/each}}
								{{/group}}
							{{else}}
								{{radio({ label : ucwords( options.value || options), icon : false, selected : true})}}
							{{/if}}
						{{/field}}
					{{/each}}
					</dl>		
				</p>
				{{/with}}
			</div>
		</script>
		
		<script type="text/javascript">
	
		$.ampere( function() {
				// this is for rendering currency in euro
			$.global.preferCulture('de-DE');
			
			$.ampere.module( function master() {
				this
				.state( function introduction() {
					
				})
				.state( function cart() {
					this.selected = -1;
					this.items = this.module.options( 'cart');
				})
				.state( function cart_remove() {
					
				}, {
					label 	: 'Remove item',
					disabled: function() {
						return this.module.states.cart.selected==-1;
					}
				})
				.state( function cart_edit() {
				}, {
					label : 'Edit item options',
					disabled : function() {
						return this.module.states.cart.selected==-1
							|| !this.module.states.cart.items[ this.module.states.cart.selected].options;
					}
				});
				
				this.states.introduction.transition( this.states.cart, {
					label : 'Demo',
					type  : 'manual' 
				});
				
				this.states.cart
				.transition( this.states.cart_edit, {
					type 	: 'manual',
					label 	: 'Edit item',
					icon	: 'ui-icon-pencil'
				})
				.transition( this.states.cart_remove, {
					type 	: 'manual',
					label 	: 'Remove item',
					icon	: 'ui-icon-trash'
				});

				this.states.cart_edit
				.transition( this.states.cart, {
					name    : 'back', 
					label 	: 'Back',
					icon	: 'ui-icon-triangle-1-w'
				})
				.transition( this.states.cart, {
					label 	: 'Update',
					icon	: 'ui-icon-disk',
					action  : this.states.cart_edit.action( function() {
						var selected = this.state.module.states.cart.selected;
						var item   = this.state.module.states.cart.items[ selected];

						var options = $.extend( {}, item.options);
						
						return function() {
							for( var name in item.options) {
								item.options[name].value = this.state[ name];
							} 

							this.flash( 'Item updated.');
							
							return function() {
								item.options = options;
								
								this.flash( 'Undoed item update.');
							};
						};	
					}) 
				})
				
				this.states.cart_remove
				.transition( this.states.cart, {
					name    : 'back', 
					label 	: 'Back',
					icon	: 'ui-icon-triangle-1-w'
				})
				.transition( this.states.cart, {
					label 	: 'Remove',
					icon	: 'ui-icon-trash',
					action  : this.states.cart_remove.action( function() {
						var selected = this.state.module.states.cart.selected;
						var item   = this.state.module.states.cart.items[ selected];
						
						return function() {
							this.state.module.states.cart.items.splice( selected, 1);
							this.state.module.states.cart.selected = -1;
							
							this.flash( 'Item removed.');

							return function() {
								this.state.module.states.cart.items.splice( selected, 0, item);
								this.state.module.states.cart.selected = selected;
								
								this.flash( 'Undoed item remove.');
							};
						};	
					}) 
				})
				.transition( this.states.cart_edit, {
					type 	: 'manual',
					label 	: 'Edit item',
					icon	: 'ui-icon-pencil'
				});
				
				for( var name in this.states) {
					var state = this.states[name];
					if( state!==this.states.introduction) {
						state.transition( this.states.introduction, {
							group 	: '$global',
							icon 	: 'ui-icon-home'
						});
					}
				}
			}, 
			{ 
				label    : $( 'head >title').text(),
				about    : $('<div><a target="_blank" href="https://github.com/lgersman/jquery.orangevolt-ampere">Ampere</a> - CopyrightÂ© 2011 by <a target="_blank" href="http://www.orangevolt.com">Orangevolt</a>.</div>'),
				state 	 : 'introduction',
				cart	 : [{ 
					label 	: 'Women extraordinary jeans', 
					url   	: 'http://www.myshop.url/pants/wejeans',
					amount  : 1,
					options	: {
						size   : { value : 'm', "values" : ["s","m","l","xl"]},
						color  : { value : false, optional : true, values  : [ "red", "green", "blue"]}
					},
					price	: 38
				}, {
					label 	: 'Women superb tank-top', 
					url   	: 'http://www.myshop.url/tops/tanktop',
					amount  : 4,
					options	: {
						size   : { value : 's', "values" : ["s","m","l","xl"]}, 
						color  : { value : 'camouflage', optional : true, values : [ "black", "camouflage", "yellow", 'dark brown']},
						belt   : 'yes'
					},
					price	: 9.99
				}, {
					label 	: 'Sunglasses "Glamour"',
					amount  : 1,
					url   	: 'http://www.myshop.url/glasses/glamour',
					price	: 7.49
				}]
			});
			
			$( 'body').module( 'master');
		},
		{ 
            debug : true,
            'jquery-ui-theme'  : 'jquery-ui/aristo/css/Aristo/jquery-ui-1.8.7.custom.css'
            				// '//ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/themes/cupertino/jquery.ui.all.css'
            				// '//ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/themes/redmond/jquery.ui.all.css'
        }
		);
		</script>
	</head>
	<body class="portal">
	</body>
</html>
