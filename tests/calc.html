<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<!--
	  Copyright (c) 2011 Lars Gersmann (lars.gersmann@gmail.com, http://orangevolt.blogspot.com)
	  Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
	  and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
	--> 
	<head>  
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=7,chrome=1; IE=9" />
		
		<title>Ampere calc example</title>
		
		<style>
			html {
				height 		: 100%;
			}
			
			body {
				height 		: 100%;
				margin 		: 0;
				overflow 	: hidden;
			}
		</style>
		
		<script type="text/javascript" src="../lib/jquery-1.5.1.js"></script>
		<script type="text/javascript" src="../lib/jquery/plugins/jquery.defer.js"></script>
		<script type="text/javascript" src="../src/jquery.ampere-defer.js"></script>
		
		<script id="main" type="text/x-jquery-tmpl">
			<table width="100%">
				<tr>
					<td colspan="3" align="right">${state.module.value}</td>
				</tr>
				{{each( $index, $row) [0,1,2]}}					
				<tr>
					{{each( $index, $col) [1,2,3]}}
						<td>
							{{radio({ label : $row*3 + $col, name : 'operand', value : $row*3 + $col})}}
						</td>
					{{/each}}
				</tr>
				{{/each}}
				<tr>
					<td></td>
					<td>
						{{radio( { label : '0', value : 0, name : 'operand'})}}
					</td>
					<td>
						{{transition( state.transitions.main)}}
					</td>
				</tr>
			</table>
		</script>
		<script type="text/javascript">
			
		// construct ampere
		$.ampere( function() {
			/* this is the ampere theme instance */	
			this.module( function calc() {
					this.value = 0;
					
					this
					.state( function main() {
						//this.view( 'main');
					})
						// sub
					.state( function sub() {
						this.view(function() {
							return [
							    '<div>',
								this.state.module.value + '-' + this.state.module.states.main.operand
								+ ' = ' + (this.state.module.value - this.state.module.states.main.operand),
								'</div>'
							].join( '');
						});
						
						this.transition( this.module.states.main, {
							action : this.action( function() {
								var operand = this.state.module.states.main.operand;

								return function() {
									this.state.module.value -= operand;
									delete this.state.module.states.main.operand;
									
									return function() {
										this.state.module.value += operand;
										this.state.module.states.main.operand = operand;
									};
								};									
							})
						});
					})
						// add
					.state( function add() {
						this.view( function() {
							return [
								'<div>',
								this.state.module.value + '+' + this.state.module.states.main.operand
								+ ' = ' + (this.state.module.value + this.state.module.states.main.operand),
								'</div>'
							].join( '');	
						});
						
						this.transition( this.module.states.main, {
							action : this.action( function() {
								var operand = this.state.module.states.main.operand;

								return function() {
									this.state.module.value += operand;
									delete this.state.module.states.main.operand;
									
									return function() {
										this.state.module.value -= operand;
										this.state.module.states.main.operand = operand;
									};
								};									
							})
						});
					})
						// div
					.state( function div() {
						this.view(function() {
							return [
								'<div>',
								this.state.module.value + '/' + this.state.module.states.main.operand
								+ ' = ' + (this.state.module.value / this.state.module.states.main.operand),
								'</div>'
							].join( '');
						});
						
						this.transition( this.module.states.main, {
							action : this.action( function() {
								var operand = this.state.module.states.main.operand;

								return function() {
									this.state.module.value /= operand;
									delete this.state.module.states.main.operand;
									
									return function() {
										this.state.module.value *= operand;
										this.state.module.states.main.operand = operand;
									};
								};									
							})
						});
					})
						// mul
					.state( function mul() {
						this.view(function() {
							return [
								'<div>',
								this.state.module.value + '*' + this.state.module.states.main.operand
								+ ' = ' + (this.state.module.value * this.state.module.states.main.operand),
								'</div>'
							].join( '');
						});
						
						this.transition( this.module.states.main, {
							action : this.action( function() {
								var operand = this.state.module.states.main.operand;

								return function() {
									this.state.module.value *= operand;
									delete this.state.module.states.main.operand;
									
									return function() {
										this.state.module.value /= operand;
										this.state.module.states.main.operand = operand;
									};
								};									
							})
						});
					});
					
					function disabled() {
						return this.state.operand===undefined;
					}
					
					this.states.main
					.transition( this.states.add, { 
						'label' 	: '+',
						disabled 	: disabled
					}) 
					.transition( this.states.sub, { 
						'label' 	: '-',
						disabled 	: disabled
					})
					.transition( this.states.div, { 
						'label' 	: '/',
						disabled 	: function() {
							var condition = this.state.operand===undefined || this.state.operand==0;
							return condition;
						}
					})
					.transition( this.states.mul, { 
						'label' 	: '*',
						disabled 	: disabled
					})
					.transition( this.states.main, { 
							type		: 'secondary',
							label       : 'CR',
							icon 		: 'ui-icon-trash', 
							action 		: this.states.main.action( function() {
								var value = this.state.module.value;

								return function() {
									this.state.module.value = 0;
									
									return function() {
										this.state.module.value = value;
									};
								};									
							}),
							disabled	: function() {
								return this.state.module.value==0;
							}
					});
				}, 
				{ 
					label    : 'Calculator',
					state    : 'main:',
					/*history  : false,*/ 
					resources: {
						styles  : [ 'calc.css']
					}
				}
			);
			
			$.when( $.ampere.theme).done( function() {
				$( 'body').module( 'calc');
			});			
		},{
			debug : true,
			module : {
				transition : {
					icon : false
				}
			}
		});
		</script>
	</head>
	<body>
	</body>
</html>