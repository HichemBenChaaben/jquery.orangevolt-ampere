<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<!--
	  Copyright (c) 2011 Lars Gersmann (lars.gersmann@gmail.com, http://orangevolt.blogspot.com)
	  Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
	  and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
	--> 
	<head>  
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=7,chrome=1; IE=9" />
	
		<link href="js/jquery-ui-1.9m3/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
		<link href="js/jquery-plugins/ampere/jquery.ampere.css" rel="stylesheet" type="text/css" />
		
		<script type="text/javascript" src="js/modernizr-1.6.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/jquery-1.4.4.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/ui/jquery-ui.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/ui/i18n/jquery-ui-i18n.js"></script>
		<script type="text/javascript" src="js/json2.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.tmpl.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.tmplPlus.js"></script>
		
		<script type="text/javascript" src="js/jquery-plugins/jquery.datalink.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.globalization.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/ampere/jquery.ampere.js"></script>
		
		<script id="main" type="text/x-jquery-tmpl">
			<table width="100%">
				<tr>
					<td colspan="3" align="right">${state.module.value}</td>
				</tr>
				{{each( $index, $row) [0,1,2]}}					
				<tr>
					{{each( $index, $col) [1,2,3]}}
						<td>
							{{radio({ label : $row*3 + $col, name : 'operand', value : $row*3 + $col})}}
						</td>
					{{/each}}
				</tr>
				{{/each}}
				<tr>
					<td></td>
					<td>
						{{radio( { label : 0, value : 0, name : 'operand'})}}
					</td>
					<td>
						{{transition( state.transitions.main)}}
					</td>
				</tr>
			</table>
		</script>
		<script id="preview" type="text/x-jquery-tmpl">
			<div>
				${state.module.value} 
				${options( 'operation')}
				${state.module.states.main.operand} 
				= 
				${options( 'preview')(state.module.value, state.module.states.main.operand)}
			</div>
		</script>
				
		<script type="text/javascript">
			
				// configure ampere
			$.ampere.options.base  = 'js/jquery-plugins/ampere';
			$.ampere.options.debug = true;
			
				// construct ampere
			$.ampere( function() {
				/* this is the ampere theme instance */	
				this/*this==$.ampere*/.module( function calc() {
						this.value = 0;
						
						this
						.state( function main() {
							this.view({
								template : 'main',
								pre 	 : function() {
									delete this.state.operand;
								}
							});
						})
						
						.state( function sub() {
							this.view({
								template  : 'preview',
								operation : '-',
								preview   : function( l, r) {
									return l-r;
								}
							});
							
							this.transition( this.module.states.main, {
								action : function() {
									this.state.module.value -= this.state.module.states.main.operand;
								}
							});
						})
						
						.state( function add() {
							this.view({
								template : 'preview',
								operation : '+',
								preview   : function( l, r) {
									return l+r;
								}
							});
							
							this.transition( this.module.states.main, {
								action : function() {
									var operand = this.state.module.states.main.operand;
									
									this.state.module.value += operand;
									
									return function() {
										this.state.module.states.main.operand = operand;
										this.state.module.value -= operand;
									};
								}
							});
						})
						
						.state( function div() {
							this.view({
								template  : 'preview',
								operation : '/',
								preview   : function( l, r) {
									return l/r;
								}
							});
							
							this.transition( this.module.states.main, {
								action : function() {
									this.state.module.value /= this.state.module.states.main.operand;
								}
							});
						})
						
						.state( function mul() {
							this.view({
								template  : 'preview',
								operation : '*',
								preview   : function( l, r) {
									return l*r;
								}
							});
							
							this.transition( this.module.states.main, {
								action : function() {
									this.state.module.value *= this.state.module.states.main.operand;
								}
							});
						})
						
						.state( function cr() {
							this.transition( this.module.states.main, {
								type   : 'auto', 
								action : function() { 
									this.state.module.value = 0;
								}
							}); 							
						});
						
						function enabled() {
							return this.state.operand!==undefined;
						}
						
						this.states.main
						.transition( this.states.add, { 
							'title' 	: '+',
							condition 	: enabled
						}) 
						.transition( this.states.sub, { 
							'title' 	: '-',
							condition 	: enabled
						})
						.transition( this.states.div, { 
							'title' 	: '/',
							condition 	: function() {
								return this.state.operand && this.state.module.value!=0;
							}
						})
						.transition( this.states.mul, { 
							'title' 	: '*',
							condition 	: enabled
						})
						.transition( this.states.main, { 
								type		: 'secondary',
								title       : 'CR',
								action 		: function() { 
									this.state.module.value = 0;
								},
								condition	: function() {
									return this.state.module.value!=0;
								}
						});
						
						return this;
					}, 
					{ 
						title    : 'Calculator',
						state   : 'main:',
						/*title    : 'Calculator',*/
						resources: {
							css  : [ 'calc.css']
						}
					}
				);
				
				$( '#app_container').module( 'calc', { donkey : 'cong'});
				
				window.e = $( '#app_container');
			});
		</script>
    </head>
    <body>
    	<div id="app_container" style="width:400px;height:250px">
    	</div>
    </body>
</html>
