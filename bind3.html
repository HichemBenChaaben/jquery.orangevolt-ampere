<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"> 
	<head>  
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=7" />
	
		<link href="js/jquery-ui-1.9m3/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
		<link href="js/jquery-plugins/ampere/jquery.ampere.css" rel="stylesheet" type="text/css" />
		
		<script type="text/javascript" src="js/modernizr-1.6.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/jquery-1.4.4.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/ui/jquery-ui.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/ui/i18n/jquery-ui-i18n.js"></script>
		<script type="text/javascript" src="js/json2.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.tmpl.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.tmplPlus.js"></script>
		
		<script type="text/javascript" src="js/jquery-plugins/jquery.datalink.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.globalization.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/ampere/jquery.ampere.js"></script>
		
		<script id="main" type="text/x-jquery-tmpl">
			<div>
			<table width="100%">
				<tr>
					<td colspan="3" align="right">${state.module.value}</td>
				</tr>
				{{each( $index, $row) [0,1,2]}}					
				<tr>
					{{each( $index, $col) [1,2,3]}}
						<td>
							{{radio({ label : $row*3 + $col, name : 'operand', value : $row*3 + $col})}}
						</td>
					{{/each}}
				</tr>
				{{/each}}
				<tr>
					<td></td>
					<td>
						{{radio( { label : 0, value : 0, name : 'operand'})}}
					</td>
					<td>
						{{transition( state.transitions.cr)}}
					</td>
				</tr>
			</table>
			</div>
		</script>
		<script id="preview" type="text/x-jquery-tmpl">
			<div>
				${state.module.value} 
				+ 
				${state.operand} 
				= 
				${state.module.value + state.operand}
			</div>
		</script>
				
		<script type="text/javascript">
			
				// configure ampere
			$.ampere.options.base  = 'js/jquery-plugins/ampere';
			$.ampere.options.debug = true;
			
				// construct ampere
			$.ampere( function() {
				/* this is the ampere theme instance */	
				this/*this==$.ampere*/.module( function calc() {
						this.log( 'hello from module ', this.options( 'title'));
						
						this.value = 0;
						
						this
						.state( function main() {
							this.view({
								template : 'main',
								pre 	 : function() {
									console.log( 'pre render');
									this.state.operand = undefined;
								},
								post 	 : function() {
									console.log( 'post render');
								}
							});
						})
						
						.state( function sub() {
							
						})
						
						.state( function add() {
							this.log( 'huhu from state ', this.log.namespace,' !!');
							
							this.view({
								template : /*function() {
									var operand = parseFloat( this.state.module.states.main.operand);
									return $( '<div>')
									.text( 
										this.state.module.value 
										+ ' + ' 
										+ operand 
										+ ' = ' + (this.state.module.value + operand) 
									);
								}*/ 'preview'
							});
							
							this.transition( this.module.states.main, {
								action : function() {
									this.state.module.value += parseFloat( this.state.module.states.main.operand);
								}
							});
						})
						
						.state( function div() {
							
						})
						
						.state( function mul() {
							
						})
						
						.state( function cr() {
							this.module.value = 0;
						});
						
						function enabled() {
							var success = this.state.operand!==undefined;
							return success;
						}
						
						this.states.main
						.transition( this.states.add, { 
							'title' 	: '+',
							condition 	: enabled,
							action : function() { this.target.operand = parseFloat( this.state.module.states.main.operand); }
						}) 
						.transition( this.states.sub, { 
							'title' 	: '-',
							condition 	: enabled
						})
						.transition( this.states.div, { 
							'title' 	: '/',
							condition 	: enabled
						})
						.transition( this.states.mul, { 
							'title' 	: '*',
							condition 	: enabled
						})
						.transition( this.states.cr, { 
								type		: 'secondary',
								action 		: function() { 
									this.log( this.log.namespace + 'called')
								},
								condition	: function() {
									var success = this.state.module.value!=0;
									return success;
							}
						});
						
						return this;
					}, 
					{ 
						stsate   : 'display:',
						/*title    : 'Calculator',*/
						resources: {
							css  : [ 'calc.css']
						}
					}
				);
				
				$( '#app_container').module( 'calc', { donkey : 'cong'});
				
				window.e = $( '#app_container');
			});
		</script>
    </head>
    <body>
    	<div id="app_container" style="width:400px">
    	</div>
    </body>
</html>
