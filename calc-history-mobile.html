<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
	<!--
	  Copyright (c) 2011 Lars Gersmann (lars.gersmann@gmail.com, http://orangevolt.blogspot.com)
	  Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
	  and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
	--> 
	<head>  
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=7,chrome=1; IE=9" />
		
		<script type="text/javascript" src="js/modernizr-1.6.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9m3/jquery-1.4.4.js"></script>
		<script type="text/javascript" src="js/json2.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.tmpl.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.tmplPlus.js"></script>
		
		<script type="text/javascript" src="js/jquery-plugins/jquery.datalink.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/jquery.globalization.js"></script>
		<script type="text/javascript" src="js/jquery-plugins/ampere/jquery.ampere.js"></script>
		
		<script id="main" type="text/x-jquery-tmpl">
			<table width="100%">
				<tr>
					<td colspan="3" align="right">${state.module.value}</td>
				</tr>
				{{each( $index, $row) [0,1,2]}}					
				<tr>
					{{each( $index, $col) [1,2,3]}}
						<td>
							{{radio({ label : $row*3 + $col, name : 'operand', value : $row*3 + $col})}}
						</td>
					{{/each}}
				</tr>
				{{/each}}
				<tr>
					<td></td>
					<td>
						{{radio( { label : '0', value : 0, name : 'operand'})}}
					</td>
					<td>
						{{transition( state.transitions.main)}}
					</td>
				</tr>
			</table>
		</script>
		<script type="text/javascript">
			
				// configure ampere
			$.ampere.options.base  = 'js/jquery-plugins/ampere';
			$.ampere.options.theme = 'mobile';
			$.ampere.options.debug = true;
			
				// construct ampere
			$.ampere( function() {
				/* this is the ampere theme instance */	
				this/*this==$.ampere*/.module( function calc() {
						this.value = 0;
						
						this
						.state( function main() {
							this.view( 'main');
						})
							// sub
						.state( function sub() {
							this.view(function() {
								return $('<div>')
								.text( this.state.module.value + '-' + this.state.module.states.main.operand
									+ ' = ' + (this.state.module.value - this.state.module.states.main.operand)	
								);
							});
							
							this.transition( this.module.states.main, {
								action : this.action( function() {
									var operand = this.state.module.states.main.operand;

									return function() {
										this.state.module.value -= operand;
										delete this.state.module.states.main.operand;
										
										return function() {
											this.state.module.value += operand;
											this.state.module.states.main.operand = operand;
										};
									};									
								})
							});
						})
							// add
						.state( function add() {
							this.view( function() {
								return $('<div>')
								.text( this.state.module.value + '+' + this.state.module.states.main.operand
									+ ' = ' + (this.state.module.value + this.state.module.states.main.operand)	
								);
							});
							
							this.transition( this.module.states.main, {
								action : this.action( function() {
									var operand = this.state.module.states.main.operand;

									return function() {
										this.state.module.value += operand;
										delete this.state.module.states.main.operand;
										
										return function() {
											this.state.module.value -= operand;
											this.state.module.states.main.operand = operand;
										};
									};									
								})
							});
						})
							// div
						.state( function div() {
							this.view(function() {
								return $('<div>')
								.text( this.state.module.value + '/' + this.state.module.states.main.operand
									+ ' = ' + (this.state.module.value / this.state.module.states.main.operand)	
								);
							});
							
							this.transition( this.module.states.main, {
								action : this.action( function() {
									var operand = this.state.module.states.main.operand;

									return function() {
										this.state.module.value /= operand;
										delete this.state.module.states.main.operand;
										
										return function() {
											this.state.module.value *= operand;
											this.state.module.states.main.operand = operand;
										};
									};									
								})
							});
						})
							// mul
						.state( function mul() {
							this.view(function() {
								return $('<div>')
								.text( this.state.module.value + '*' + this.state.module.states.main.operand
									+ ' = ' + (this.state.module.value * this.state.module.states.main.operand)	
								);
							});
							
							this.transition( this.module.states.main, {
								action : this.action( function() {
									var operand = this.state.module.states.main.operand;

									return function() {
										this.state.module.value *= operand;
										delete this.state.module.states.main.operand;
										
										return function() {
											this.state.module.value /= operand;
											this.state.module.states.main.operand = operand;
										};
									};									
								})
							});
						});
						
						function enabled() {
							return this.state.operand!==undefined;
						}
						
						this.states.main
						.transition( this.states.add, { 
							'title' 	: '+',
							condition 	: enabled
						}) 
						.transition( this.states.sub, { 
							'title' 	: '-',
							condition 	: enabled
						})
						.transition( this.states.div, { 
							'title' 	: '/',
							condition 	: function() {
								return this.state.operand && this.state.module.value!=0;
							}
						})
						.transition( this.states.mul, { 
							'title' 	: '*',
							condition 	: enabled
						})
						.transition( this.states.main, { 
								type		: 'secondary',
								title       : false,
								icon 		: 'ui-icon-trash', 
								action 		: this.states.main.action( function() {
									var value = this.state.module.value;

									return function() {
										this.state.module.value = 0;
										
										return function() {
											this.state.module.value = value;
										};
									};									
								}),
								condition	: function() {
									return this.state.module.value!=0;
								}
						});
					}, 
					{ 
						title    : 'Calculator',
						state    : 'main:',
						/*history  : false,*/ 
						resources: {
							css  : [ 'calc.css']
						}
					}
				);
				
				$( '#app_container').module( 'calc');
				
				window.e = $( '#app_container');
			});
		</script>
    </head>
    <body>
    	<div id="app_container" data-role="page"  style="width:400px;height:250px">
    	</div>
    </body>
</html>
